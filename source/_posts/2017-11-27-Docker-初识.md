---
title: Docker 初识
categories: Docker
tags:
  - Docker
comments: false
copyright: true
top: 10
abbrlink: fd0b65d2
date: 2017-11-27 14:50:54
---

# Docker 初识

### 目录

[相关文档](#相关文档)

[简介](#简介)

[概念](#概念)

[Docekr 基础环境搭建](#基础环境搭建)

[Docker 运用场景](#运用场景)

### <a id="相关文档"></a>相关文档

- [大白话Docker入门（一）](https://yq.aliyun.com/articles/63035?utm_campaign=wenzhang&utm_medium=article&utm_source=QQ-qun&utm_content=m_7538)
- [利用Docker构建开发环境详解](http://www.linuxidc.com/Linux/2014-10/107969.htm)
- [宋宝华：Docker 最初的2小时(Docker从入门到入门)](http://blog.csdn.net/21cnbao/article/details/56275456)
- [初探Docker](https://aotu.io/notes/2016/02/27/docker/index.html)
- [Docker实战--部署简单nodejs应用](https://www.cnblogs.com/liusc/p/docker_node.html)
- [Docker 镜像加速器](https://yq.aliyun.com/articles/29941)

### <a id="简介"></a>简介

Docker是一个开源的引擎，可以轻松的为任何应用创建一个轻量级的、可移植的、自给自足的容器。开发者在笔记本上编译测试通过的容器可以批量地在生产环境中部署，包括VMs（虚拟机）、bare metal、OpenStack 集群和其他的基础应用平台。

### <a id="概念"></a>概念

KVM, Virtualbox, Vmware是虚拟出机器，让每个实例看到一个单独的机器；而Docker是虚拟出操作系统，实现应用之间的隔离，让各个应用觉得自己有一个自己的操作系统，而且彼此之间隔离。

Docker由下面几样东西组成：

- Docker Client : Docker提供给用户的客户端。Docker Client提供给用户一个终端，用户输入Docker提供的命令来管理本地或者远程的服务器。
- Docker Daemon : Docker服务的守护进程。每台服务器（物理机或虚机）上只要安装了Docker的环境，基本上就跑了一个后台程序Docker Daemon，Docker Daemon会接收Docker Client发过来的指令,并对服务器的进行具体操作。
- Docker Images : 俗称Docker的镜像，这个可难懂了。你暂时可以认为这个就像我们要给电脑装系统用的系统CD盘，里面有操作系统的程序，并且还有一些CD盘在系统的基础上安装了必要的软件，做成的一张 “只读” 的CD。
- Docker Registry : 这个可认为是Docker Images的仓库，就像git的仓库一样，用来管理Docker镜像的，提供了Docker镜像的上传、下载和浏览等功能，并且提供安全的账号管理可以管理只有自己可见的私人image。就像git的仓库一样，docker也提供了官方的Registry，叫做[Dock Hub](http://hub.Docker.com)
- Docker Container : 俗称Docker的容器，这个是最关键的东西了。Docker Container是真正跑项目程序、消耗机器资源、提供服务的地方，Docker Container通过Docker Images启动，在Docker Images的基础上运行你需要的代码。 你可以认为Docker Container提供了系统硬件环境，然后使用了Docker Images这些制作好的系统盘，再加上你的项目代码，跑起来就可以提供服务了。

![](http://oyz8j0ezy.bkt.clouddn.com/docker_build.png)

<!--more-->

Docker Container 的示例图：

![](http://oyz8j0ezy.bkt.clouddn.com/docker_container.png)

Container和Image 在Docker的世界里，Image是指一个只读的层（Layer），这里的层是AUFS里的概念，最直观的方式就是看一下docker官方给出的图：

![](http://oyz8j0ezy.bkt.clouddn.com/dockercontainerandimage.png)

Docker使用了一种叫AUFS的文件系统，这种文件系统可以让你一层一层地叠加修改你的文件，最底下的文件系统是只读的，如果需要修改文件，AUFS会增加一个可写的层（Layer），这样有很多好处，例如不同的Container可以共享底层的只读文件系统（同一个Kernel），使得你可以跑N多个Container而不至于你的硬盘被挤爆了！这个只读的层就是Image！而如你所看到的，一个可写的层就是Container。

### <a id="基础环境搭建"></a>Docker 基础环境搭建（阿里云仓库创建、提交）

- 首先安装基于你的系统的Docker环境，建议参考[docker](http://www.docker.com/products/docker)的官网以及相关问题百度。
（注：如果是win10专业版，因为自带了虚拟机Hyper-V,所以可以下载专门匹配的docker for windows 10，其他的window版本，建议下载Docker Toolbox，它包含了运行Docker时需要的一切：Docker客户端、Compose（仅Mac需要）、Kitematic、Machine以及VirtualBox。）

- 安装完成后一般双击你桌面的快捷图标（Docker Quickstart Terminal），它会初始化去github下载一个虚拟机的默认的default镜像文件，一般这个下载非常慢，建议直接访问https://github.com/boot2docker/boot2docker/releases 下载对应版本的boot2docker.iso
然后复制粘贴到C:\Users\LN\.docker\machine\cache目录下，这样可以完成docker的首次启动。
查看 docker version 

![](http://oyz8j0ezy.bkt.clouddn.com/dockerversion.png)

我们也可以查看相关的一些命令，查看镜像 docker images、查看容器 docker ps -a 、查看正在运行的容器 docker ps 等。

- 因为docker默认的官方仓库是https://hub.docker.com , 访问困难，所以我们在拉取镜像的时候一般选择国内的docker仓库，如网易，阿里都有对应的docker镜像仓库。我们拿[阿里](https://dev.aliyun.com/search.html)的仓库镜像做介绍。使用docker info  查看我们是否配备好了国内加速器。

- 拉取镜像 docker pull centos ，使用阿里云加速。使用命令  sudo docker run -it ubuntu:14.04 /bin/bash ， 运行之后我们就有了一个Ubuntu的基础环境，我们可以把拉取下来的镜像 添加gcc和vim ，添加构建文件Dockerfile

```bash
mkdir myubuntuWithVimAndGcc
cd myubuntuWithVimAndGcc && touch Dockerfile
vi Dockerfile
```

```bash
# Ubuntu 14.04 with vim and gcc
FROM ubuntu:14.04
MAINTAINER Barry Song<ningfan210@163.com
RUN apt-get update && apt-get install -y vim gcc
```

然后通过命令 sudo docker build -t ubuntu/ubuntuwithvimandgcc . ，试着运行一下,
测试下gcc 和 vim ,发现已经装好了，
![](http://oyz8j0ezy.bkt.clouddn.com/ubuntuwithgcc.png)

- 最后我们可以发布我们的镜像到阿里的自己的仓库中，可以让别人拉取。

### <a id="运用场景"></a>Docker 运用场景 （Docker 搭建基础项目环境）

- 作为示范，我们演示下，在docker环境中搭建一个运行在nodejs环境下的hexo博客。
首先编写构建文件Dockerfile：

```bash
FROM node
MAINTAINER NANMEN

RUN npm install -g hexo --registry=https://registry.npm.taobao.org

RUN mkdir -p hexofile

WORKDIR /hexofile

RUN hexo init

RUN hexo generate

EXPOSE 4000

CMD ["hexo","server"]
~
```

然后使用命令 sudo docker build -t hexo/node . 命令构建我们的hexo的镜像，因为hexo运行时是跑在端口4000上，所以我们在执行运行命令的时候需要运用到 -p 命令做端口映射，如 
sudo docker run -d -p 4000:4000 hexo/node:latest ,然后在浏览器中访问 http://localhost:4000/ 

![](http://oyz8j0ezy.bkt.clouddn.com/dockerandhexo.png)
